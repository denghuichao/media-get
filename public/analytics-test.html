<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics äº‹ä»¶è·Ÿè¸ªæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .button:hover {
            background: #0056b3;
        }

        .button.analyze {
            background: #6f42c1;
        }

        .button.download {
            background: #28a745;
        }

        .event-log {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
            font-size: 12px;
            border-left: 4px solid #007bff;
        }

        .platform-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
    </style>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1FGK5KKNVX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-1FGK5KKNVX');

        // äº‹ä»¶æ—¥å¿—æ•°ç»„
        let eventLog = [];

        // é‡å†™gtagå‡½æ•°æ¥æ•è·äº‹ä»¶
        const originalGtag = window.gtag;
        window.gtag = function (command, eventName, parameters) {
            // è°ƒç”¨åŸå§‹å‡½æ•°
            originalGtag.apply(this, arguments);

            // è®°å½•äº‹ä»¶
            if (command === 'event') {
                eventLog.push({
                    eventName,
                    parameters,
                    timestamp: new Date().toLocaleTimeString()
                });
                updateEventLog();
            }
        };

        // æ¨¡æ‹Ÿanalyticså‡½æ•°
        const trackAnalyzeClick = (platform, url) => {
            gtag('event', 'analyze_button_click', {
                platform: platform,
                url_domain: new URL(url).hostname,
                event_category: 'engagement',
                event_label: 'analyze_media',
                custom_parameter_platform: platform
            });
        };

        const trackDownloadClick = (platform, mediaType, format, isPlaylist = false) => {
            gtag('event', 'download_button_click', {
                platform: platform,
                media_type: mediaType,
                format: format,
                is_playlist: isPlaylist,
                event_category: 'conversion',
                event_label: 'start_download',
                custom_parameter_platform: platform,
                custom_parameter_media_type: mediaType
            });
        };

        const trackDownloadComplete = (platform, mediaType, format, success, fileCount = 1) => {
            gtag('event', 'download_complete', {
                platform: platform,
                media_type: mediaType,
                format: format,
                success: success,
                file_count: fileCount,
                event_category: 'conversion',
                event_label: success ? 'download_success' : 'download_failure',
                custom_parameter_platform: platform,
                custom_parameter_media_type: mediaType
            });
        };

        const getPlatformFromUrl = (url) => {
            try {
                const hostname = new URL(url).hostname.toLowerCase();
                if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) return 'YouTube';
                if (hostname.includes('twitter.com') || hostname.includes('x.com')) return 'Twitter/X';
                if (hostname.includes('instagram.com')) return 'Instagram';
                if (hostname.includes('tiktok.com')) return 'TikTok';
                if (hostname.includes('bilibili.com')) return 'Bilibili';
                return hostname.split('.')[1] || 'Other';
            } catch {
                return 'Unknown';
            }
        };

        // æ›´æ–°äº‹ä»¶æ—¥å¿—æ˜¾ç¤º
        const updateEventLog = () => {
            const logContainer = document.getElementById('eventLog');
            if (logContainer) {
                logContainer.innerHTML = eventLog.slice(-10).reverse().map(event => `
                    <div class="event-item">
                        <strong>${event.eventName}</strong> (${event.timestamp})<br>
                        Platform: ${event.parameters.platform || 'N/A'}, 
                        Type: ${event.parameters.media_type || event.parameters.action || 'N/A'}
                        ${event.parameters.format ? ', Format: ' + event.parameters.format : ''}
                    </div>
                `).join('');
            }
        };

        // æµ‹è¯•å‡½æ•°
        const testAnalyze = (platform, url) => {
            trackAnalyzeClick(platform, url);
            console.log(`Analytics: Analyze clicked for ${platform}`);
        };

        const testDownload = (platform, mediaType, format, isPlaylist = false) => {
            trackDownloadClick(platform, mediaType, format, isPlaylist);
            console.log(`Analytics: Download clicked for ${platform} (${mediaType})`);
        };

        const testDownloadComplete = (platform, mediaType, success) => {
            trackDownloadComplete(platform, mediaType, 'test-format', success, success ? Math.floor(Math.random() * 3) + 1 : 0);
            console.log(`Analytics: Download completed for ${platform} (${success ? 'success' : 'failed'})`);
        };
    </script>
</head>

<body>
    <div class="container">
        <h1>ğŸ“Š Google Analytics äº‹ä»¶è·Ÿè¸ªæµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢æ¼”ç¤ºäº†MediaGetåº”ç”¨ä¸­é›†æˆçš„Google Analyticsäº‹ä»¶è·Ÿè¸ªåŠŸèƒ½ã€‚ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œå¹¶æŸ¥çœ‹Analyticsäº‹ä»¶ã€‚</p>

        <h2>ğŸ” åˆ†ææŒ‰é’®æµ‹è¯•</h2>
        <div class="platform-buttons">
            <button class="button analyze" onclick="testAnalyze('YouTube', 'https://youtube.com/watch?v=test')">åˆ†æ
                YouTube</button>
            <button class="button analyze" onclick="testAnalyze('TikTok', 'https://tiktok.com/@user/video/123')">åˆ†æ
                TikTok</button>
            <button class="button analyze" onclick="testAnalyze('Instagram', 'https://instagram.com/p/test/')">åˆ†æ
                Instagram</button>
            <button class="button analyze" onclick="testAnalyze('Twitter/X', 'https://twitter.com/user/status/123')">åˆ†æ
                Twitter/X</button>
            <button class="button analyze" onclick="testAnalyze('Bilibili', 'https://bilibili.com/video/BV123')">åˆ†æ
                Bilibili</button>
        </div>

        <h2>ğŸ“¥ ä¸‹è½½æŒ‰é’®æµ‹è¯•</h2>
        <div class="platform-buttons">
            <button class="button download" onclick="testDownload('YouTube', 'video', 'mp4-1080p')">ä¸‹è½½ YouTube
                è§†é¢‘</button>
            <button class="button download" onclick="testDownload('Spotify', 'audio', 'mp3-320')">ä¸‹è½½ Spotify éŸ³é¢‘</button>
            <button class="button download" onclick="testDownload('Instagram', 'image', 'jpg')">ä¸‹è½½ Instagram å›¾ç‰‡</button>
            <button class="button download" onclick="testDownload('YouTube', 'video', 'playlist', true)">ä¸‹è½½ YouTube
                æ’­æ”¾åˆ—è¡¨</button>
            <button class="button download" onclick="testDownload('TikTok', 'video', 'mp4-720p')">ä¸‹è½½ TikTok è§†é¢‘</button>
        </div>

        <h2>âœ… ä¸‹è½½å®Œæˆæµ‹è¯•</h2>
        <div class="platform-buttons">
            <button class="button" onclick="testDownloadComplete('YouTube', 'video', true)">YouTube ä¸‹è½½æˆåŠŸ</button>
            <button class="button" onclick="testDownloadComplete('TikTok', 'video', false)">TikTok ä¸‹è½½å¤±è´¥</button>
            <button class="button" onclick="testDownloadComplete('Spotify', 'audio', true)">Spotify ä¸‹è½½æˆåŠŸ</button>
        </div>

        <h2>ğŸ“‹ äº‹ä»¶æ—¥å¿— (æœ€è¿‘10æ¡)</h2>
        <div id="eventLog" class="event-log">
            <p>ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®æ¥ç”ŸæˆAnalyticsäº‹ä»¶...</p>
        </div>

        <h2>ğŸ“ˆ æŸ¥çœ‹å®æ—¶æ•°æ®</h2>
        <p>
            <strong>Google Analytics å®æ—¶æŠ¥å‘Šï¼š</strong><br>
            1. è®¿é—® <a href="https://analytics.google.com" target="_blank">Google Analytics</a><br>
            2. é€‰æ‹©æ‚¨çš„åª’ä½“å±æ€§<br>
            3. åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» "å®æ—¶" â†’ "æ¦‚è§ˆ"<br>
            4. ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®ï¼Œäº‹ä»¶åº”è¯¥ä¼šåœ¨å®æ—¶æŠ¥å‘Šä¸­æ˜¾ç¤º
        </p>

        <h2>ğŸ¯ æ”¯æŒçš„äº‹ä»¶ç±»å‹</h2>
        <ul>
            <li><strong>analyze_button_click</strong> - ç”¨æˆ·ç‚¹å‡»åˆ†ææŒ‰é’®</li>
            <li><strong>download_button_click</strong> - ç”¨æˆ·ç‚¹å‡»ä¸‹è½½æŒ‰é’®</li>
            <li><strong>download_complete</strong> - ä¸‹è½½å®Œæˆ(æˆåŠŸæˆ–å¤±è´¥)</li>
            <li><strong>platform_usage</strong> - å¹³å°ä½¿ç”¨ç»Ÿè®¡</li>
        </ul>

        <h2>ğŸ“Š è‡ªå®šä¹‰ç»´åº¦</h2>
        <ul>
            <li><strong>platform</strong> - åª’ä½“å¹³å°(YouTube, TikTok, Instagramç­‰)</li>
            <li><strong>media_type</strong> - åª’ä½“ç±»å‹(video, audio, image)</li>
            <li><strong>format</strong> - ä¸‹è½½æ ¼å¼</li>
            <li><strong>is_playlist</strong> - æ˜¯å¦ä¸ºæ’­æ”¾åˆ—è¡¨</li>
            <li><strong>success</strong> - ä¸‹è½½æ˜¯å¦æˆåŠŸ</li>
            <li><strong>file_count</strong> - æ–‡ä»¶æ•°é‡</li>
        </ul>
    </div>
</body>

</html>